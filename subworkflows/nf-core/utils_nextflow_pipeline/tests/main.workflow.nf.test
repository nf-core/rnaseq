nextflow_workflow {

    name "Test Workflow UTILS_NEXTFLOW_PIPELINE"
    script "../main.nf"
    config "subworkflows/nf-core/utils_nextflow_pipeline/tests/nextflow.config"
    workflow "UTILS_NEXTFLOW_PIPELINE"
    tag 'subworkflows'
    tag 'utils_nextflow_pipeline'
    tag 'subworkflows/utils_nextflow_pipeline'

    test("Should run no inputs") {

        when {
            params {
                outdir = "tests/results"
            }
            workflow {
                """
                print_version        = false
                dump_parameters      = false
                outdir               = null
                check_conda_channels = false

                input[0] = print_version
                input[1] = dump_parameters
                input[2] = outdir
                input[3] = check_conda_channels
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }

    test("Should print version") {

        when {
            params {
                outdir = "tests/results"
            }
            workflow {
                """
                print_version        = true
                dump_parameters      = false
                outdir               = null
                check_conda_channels = false

                input[0] = print_version
                input[1] = dump_parameters
                input[2] = outdir
                input[3] = check_conda_channels
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success },
                { assert workflow.stdout.contains("nextflow_workflow v9.9.9") }
            )
        }
    }

    test("Should dump params") {

        when {
            params {
                outdir = "$outputDir"
            }
            workflow {
                """
                print_version        = false
                dump_parameters      = true
                outdir               = params.outdir
                check_conda_channels = false

                input[0] = false
                input[1] = true
                input[2] = params.outdir
                input[3] = false
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }

    test("Should not create params JSON if no output directory") {

        when {
            params {
                outdir = "$outputDir"
            }
            workflow {
                """
                print_version        = false
                dump_parameters      = true
                outdir               = params.outdir
                check_conda_channels = false

                input[0] = false
                input[1] = true
                input[2] = null
                input[3] = false
                """
            }
        }

        then {
            assertAll(
                { assert workflow.success }
            )
        }
    }
}
