ext.args   = { [
    '--quantMode TranscriptomeSAM',
    '--twopassMode Basic',
    '--outSAMtype BAM Unsorted',
    '--readFilesCommand zcat',
    '--runRNGseed 0',
    '--outFilterMultimapNmax 20',
    '--alignSJDBoverhangMin 1',
    '--outSAMattributes NH HI AS NM MD',
    '--quantTranscriptomeBan Singleend',
    '--outSAMstrandField intronMotif',
    params.save_unaligned ? '--outReadsUnmapped Fastx' : '',
    params.extra_star_align_args ? params.extra_star_align_args.split("\\s(?=--)") : ''
].flatten().unique(false).join(' ').trim() }

publishDir = [
    [
        path: { "${params.outdir}/${params.aligner}/log" },
        mode: params.publish_dir_mode,
        pattern: '*.{out,tab}'
    ],
    [
        path: { "${params.outdir}/${params.aligner}" },
        mode: params.publish_dir_mode,
        pattern: '*.bam',
        saveAs: { params.save_align_intermeds ? it : null }
    ],
    [
        path: { "${params.outdir}/${params.aligner}/unmapped" },
        mode: params.publish_dir_mode,
        pattern: '*.fastq.gz',
        saveAs: { params.save_unaligned ? it : null }
    ]
]